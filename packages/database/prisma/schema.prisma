// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Audit Logs
model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  entityType String
  entityId   String
  oldValues  String? // JSON
  newValues  String? // JSON
  metadata   String? // API expects metadata (JSON)
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  // Relations
  user User? @relation("AuditLogs", fields: [userId], references: [id])

  @@map("audit_logs")
}

// Users
model User {
  id                       String     @id @default(cuid())
  email                    String     @unique
  username                 String     @unique
  passwordHash             String? 
  firstName                String?
  lastName                 String?
  dateOfBirth              DateTime? // Added for auth service
  phone                    String?
  phoneNumber              String? // Added for auth service
  profilePhotoUrl          String?
  bio                      String?
  role                     UserRole   @default(USER)
  status                   UserStatus @default(ACTIVE)
  isActive                 Boolean    @default(true)
  averageRating            Float?     @default(0)
  totalReviews             Int        @default(0)
  responseRate             Float? // API expects responseRate
  responseTime             String? // API expects responseTime
  stripeCustomerId         String?
  stripeConnectId          String?
  stripeChargesEnabled     Boolean? // API expects stripeChargesEnabled
  stripePayoutsEnabled     Boolean? // API expects stripePayoutsEnabled
  stripeOnboardingComplete Boolean? // API expects stripeOnboardingComplete
  emailVerified            Boolean    @default(false)
  phoneVerified            Boolean? // API expects phoneVerified
  mfaEnabled               Boolean? // API expects mfaEnabled
  emailVerificationToken   String?
  passwordResetToken       String?
  passwordResetExpires     DateTime?
  lastLoginAt              DateTime?
  lastLoginIp              String? // Added for auth service
  mfaSecret                String? // API expects mfaSecret
  idVerificationStatus     String? // API expects idVerificationStatus
  idVerificationUrl        String? // API expects idVerificationUrl
  governmentIdNumber       String? // API expects governmentIdNumber
  addressLine1             String? // API expects addressLine1
  addressLine2             String? // API expects addressLine2
  city                     String? // API expects city
  state                    String? // API expects state
  postalCode               String? // API expects postalCode
  country                  String? // API expects country
  deletedAt                DateTime? // API expects deletedAt
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt

  // Relations
  listings                   Listing[]                 @relation("Listings")
  bookings                   Booking[]                 @relation("BookingRenter")
  bookingsOwned              Booking[]                 @relation("BookingsOwned")
  payouts                    Payout[]
  auditLogs                  AuditLog[]                @relation("AuditLogs")
  reviewsGiven               Review[]                  @relation("ReviewGiven")
  reviewsReceived            Review[]                  @relation("ReviewReceived")
  organizations              Organization[]            @relation("OrganizationOwners")
  members                    OrganizationMember[]      @relation("UserMembers")
  notifications              Notification[]
  sessions                   Session[]
  deviceTokens               DeviceToken[]
  favoriteListings           FavoriteListing[]
  userPreferences            UserPreferences?
  conditionReportsCreated    ConditionReport[]         @relation("ConditionReportCreator")
  insurancePoliciesOwned     InsurancePolicy[]         @relation("InsurancePolicyOwner")
  messagesSent               Message[]                 @relation("MessageSender")
  conversationParticipations ConversationParticipant[]
  messageReadReceipts        MessageReadReceipt[]
  disputesInitiated          Dispute[]                 @relation("DisputeInitiator")
  disputesDefended           Dispute[]                 @relation("DisputeDefendant")
  disputesAssigned           Dispute[]                 @relation("DisputeAssignee")
  disputeResponses           DisputeResponse[]

  @@map("users")
}

// Properties (API expects listing)
model Listing {
  id                   String             @id @default(cuid())
  title                String
  slug                 String             @unique
  description          String?
  address              String
  city                 String
  state                String
  zipCode              String
  country              String
  latitude             Float?
  longitude            Float?
  type                 PropertyType
  bookingMode          BookingMode        @default(REQUEST) // Added for bookings service
  status               PropertyStatus     @default(AVAILABLE)
  verificationStatus   VerificationStatus @default(PENDING)
  condition            PropertyCondition?
  bedrooms             Int?
  bathrooms            Int?
  maxGuests            Int?
  basePrice            Decimal
  currency             String             @default("USD")
  securityDeposit      Decimal?
  cleaningFee          Decimal?
  amenities            String[] // JSON array
  features             String[] // JSON array - API expects features
  photos               String[] // JSON array
  rules                String[] // JSON array
  cancellationPolicyId String?
  categoryId           String?
  organizationId       String?
  ownerId              String
  averageRating        Float?             @default(0)
  totalReviews         Int                @default(0)
  totalBookings        Int                @default(0)
  views                Int                @default(0)
  viewCount            Int                @default(0) // API expects viewCount
  instantBookable      Boolean            @default(false)
  minStayNights        Int                @default(1)
  maxStayNights        Int?
  checkInTime          String? // e.g., "15:00"
  checkOutTime         String? // e.g., "11:00"
  weeklyDiscount       Int? // Percentage discount for weekly stays
  monthlyDiscount      Int? // Percentage discount for monthly stays
  serviceFee           Decimal?
  isActive             Boolean            @default(true)
  featured             Boolean            @default(false)
  lastBookedAt         DateTime?
  metadata             String? // JSON
  deletedAt            DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt

  // Relations
  owner              User                @relation("Listings", fields: [ownerId], references: [id], onDelete: Cascade)
  category           Category?           @relation(fields: [categoryId], references: [id])
  cancellationPolicy CancellationPolicy? @relation(fields: [cancellationPolicyId], references: [id])
  organization       Organization?       @relation(fields: [organizationId], references: [id])
  bookings           Booking[]           @relation("BookingListing")
  reviews            Review[]
  reviewListings     Review[]            @relation("ReviewListing")
  favorites          FavoriteListing[]
  conditionReports   ConditionReport[]
  insurancePolicies  InsurancePolicy[]
  insuranceClaims    InsuranceClaim[]    @relation("PropertyClaims")
  conversations      Conversation[]      @relation("PropertyConversations")
  availability       Availability[]      @relation("PropertyAvailability")

  @@map("properties") // Table name stays properties but API will see it as listing
}

// Categories
model Category {
  id               String       @id @default(cuid())
  name             String       @unique
  slug             String       @unique
  description      String?
  icon             String?
  parentId         String?
  isActive         Boolean      @default(true)
  active           Boolean      @default(true) // Added for categories service
  order            Int? // Added for categories service
  pricingMode      PricingMode? // Added for categories service
  searchableFields String[] // Added for categories service - JSON array
  requiredFields   String[] // Added for categories service - JSON array
  templateSchema   String? // API expects templateSchema (JSON)
  dailyPrice       Decimal? // API expects dailyPrice
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  // Relations
  parent     Category?  @relation("CategoryParent", fields: [parentId], references: [id])
  children   Category[] @relation("CategoryParent")
  listings   Listing[]

  @@map("categories")
}

// Organizations
model Organization {
  id                 String             @id @default(cuid())
  name               String
  slug               String             @unique
  description        String?
  logo               String?
  logoUrl            String? // API expects logoUrl
  website            String?
  email              String?
  phone              String?
  address            String?
  city               String?
  state              String?
  zipCode            String?
  country            String?
  ownerId            String? // API expects ownerId
  stripeConnectId    String?
  businessType       String? // INDIVIDUAL | LLC | CORPORATION | PARTNERSHIP
  status             OrganizationStatus @default(ACTIVE)
  verificationStatus VerificationStatus @default(PENDING)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  // Relations
  owner      User?                @relation("OrganizationOwners", fields: [ownerId], references: [id])
  members    OrganizationMember[]
  listings   Listing[]

  @@map("organizations")
}

model OrganizationMember {
  id             String           @id @default(cuid())
  organizationId String
  userId         String
  role           OrganizationRole @default(MEMBER)
  joinedAt       DateTime         @default(now())
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User         @relation("UserMembers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId])
  @@map("organization_members")
}

// Bookings
model Booking {
  id                 String        @id @default(cuid())
  listingId          String // API expects listingId
  renterId           String // API expects renterId
  ownerId            String? // API expects ownerId
  startDate          DateTime
  endDate            DateTime
  basePrice          Decimal
  securityDeposit    Decimal?
  cleaningFee        Decimal?
  serviceFee         Decimal?
  totalPrice         Decimal
  currency           String        @default("USD")
  status             BookingStatus @default(PENDING)
  paymentIntentId    String?
  chargeId           String?
  refundId           String?
  specialRequests    String?
  guestNotes         String?
  ownerNotes         String?
  checkInTime        String?
  checkOutTime       String?
  ownerEarnings      Decimal? // API expects ownerEarnings
  platformFee        Decimal?
  depositAmount      Decimal? // API expects depositAmount
  totalAmount        Decimal? // API expects totalAmount
  guestCount         Int           @default(1)
  notes              String?
  metadata           String? // JSON
  cancelledAt        DateTime? // Added for booking processor
  completedAt        DateTime? // Added for booking processor
  cancellationReason String? // Added for booking processor
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  // Relations
  listing           Listing               @relation("BookingListing", fields: [listingId], references: [id], map: "bookings_listingId_fkey")
  renter            User                  @relation("BookingRenter", fields: [renterId], references: [id], map: "bookings_renter_fkey")
  bookingOwner      User?                 @relation("BookingsOwned", fields: [ownerId], references: [id], map: "bookings_bookingOwner_fkey")
  payments          Payment[]
  refunds           Refund[]
  depositHolds      DepositHold[]
  reviews           Review[]
  conditionReports  ConditionReport[]
  insurancePolicies InsurancePolicy[]
  insuranceClaims   InsuranceClaim[]
  conversations     Conversation[]
  disputes          Dispute[]
  ledgerEntries     LedgerEntry[]
  stateHistory      BookingStateHistory[]

  @@unique([listingId, startDate, endDate])
  @@map("bookings")
}

// Reviews
model Review {
  id                  String       @id @default(cuid())
  bookingId           String?
  propertyId          String?
  listingId           String? // API expects listingId (alias for propertyId)
  reviewerId          String
  revieweeId          String
  type                ReviewType
  rating              Int // 1-5
  overallRating       Int? // For detailed ratings
  accuracyRating      Int?
  communicationRating Int?
  cleanlinessRating   Int?
  valueRating         Int?
  locationRating      Int?
  checkInRating       Int?
  comment             String?
  response            String?
  content             String? // API expects content (alias for comment)
  status              ReviewStatus @default(PUBLISHED)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  // Relations
  booking  Booking?  @relation(fields: [bookingId], references: [id])
  property Listing?  @relation(fields: [propertyId], references: [id])
  listing  Listing?  @relation("ReviewListing", fields: [listingId], references: [id])
  reviewer User      @relation("ReviewGiven", fields: [reviewerId], references: [id])
  reviewee User      @relation("ReviewReceived", fields: [revieweeId], references: [id])

  @@unique([bookingId, reviewerId])
  @@map("reviews")
}

// Payments
model Payment {
  id                    String        @id @default(cuid())
  bookingId             String
  amount                Decimal
  currency              String        @default("USD")
  status                PaymentStatus @default(PENDING)
  paymentMethod         String?
  paymentIntentId       String        @unique
  stripePaymentIntentId String? // API expects stripePaymentIntentId
  chargeId              String?
  stripeChargeId        String? // API expects stripeChargeId
  refundId              String?
  fee                   Decimal?
  netAmount             Decimal?
  processedAt           DateTime? // API expects processedAt
  failureReason         String? // API expects failureReason
  description           String?
  metadata              String? // JSON
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])

  @@map("payments")
}

// Refunds
model Refund {
  id          String       @id @default(cuid())
  bookingId   String
  amount      Decimal
  currency    String       @default("USD")
  status      RefundStatus @default(PENDING)
  refundId    String       @unique
  reason      String?
  description String?
  metadata    String? // JSON
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])

  @@map("refunds")
}

// Deposit Holds
model DepositHold {
  id              String        @id @default(cuid())
  bookingId       String
  amount          Decimal
  currency        String        @default("USD")
  status          DepositStatus @default(PENDING)
  stripeId        String? // Stripe charge/hold ID
  paymentIntentId String? // API expects paymentIntentId
  expiresAt       DateTime? // API expects expiresAt
  releasedAt      DateTime? // API expects releasedAt
  capturedAt      DateTime? // API expects capturedAt
  deductedAmount  Decimal? // API expects deductedAmount
  metadata        String? // JSON
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])

  @@map("deposit_holds")
}

// Payouts
model Payout {
  id          String       @id @default(cuid())
  ownerId     String
  amount      Decimal
  currency    String       @default("USD")
  status      PayoutStatus @default(PENDING)
  stripeId    String? // Stripe transfer ID
  transferId  String? // API expects transferId
  paidAt      DateTime? // API expects paidAt
  processedAt DateTime? // API expects processedAt
  metadata    String? // JSON
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  owner User @relation(fields: [ownerId], references: [id])

  @@map("payouts")
}

// Ledger Entries
model LedgerEntry {
  id              String            @id @default(cuid())
  bookingId       String?
  accountId       String
  accountType     AccountType
  side            LedgerSide
  transactionType TransactionType
  amount          Decimal
  currency        String            @default("USD")
  description     String
  status          LedgerEntryStatus @default(PENDING)
  metadata        String? // JSON
  referenceId     String? // Added for admin service
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  // Relations
  booking Booking? @relation(fields: [bookingId], references: [id])

  @@map("ledger_entries")
}

// Property Availability
model Availability {
  id         String   @id @default(cuid())
  propertyId String
  startDate  DateTime
  endDate    DateTime
  status     String   @default("available") // available, booked, blocked
  price      Decimal? // Custom price for this period
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  property Listing @relation("PropertyAvailability", fields: [propertyId], references: [id])

  @@map("availability")
}

// Booking State History
model BookingStateHistory {
  id         String         @id @default(cuid())
  bookingId  String
  fromStatus BookingStatus?
  toStatus   BookingStatus
  reason     String?
  metadata   String? // JSON
  changedBy  String? // Added for booking state machine
  createdAt  DateTime       @default(now())

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])

  @@map("booking_state_history")
}

// Notifications
model Notification {
  id           String           @id @default(cuid())
  userId       String
  type         NotificationType
  title        String
  message      String
  data         String? // JSON
  actionUrl    String? // URL for action button
  read         Boolean          @default(false)
  readAt       DateTime? // When notification was read
  status       String? // Added for admin service
  sentViaEmail Boolean          @default(false) // Added for notifications service
  sentViaPush  Boolean          @default(false) // Added for notifications service
  sentViaSMS   Boolean? // Added for notifications service
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// Sessions
model Session {
  id           String   @id @default(cuid())
  userId       String
  token        String   @unique
  refreshToken String?  @unique
  expiresAt    DateTime
  ipAddress    String? // Added for auth service
  userAgent    String? // Added for auth service
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// Device Tokens for push notifications
model DeviceToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  platform  String // ios, android, web
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("device_tokens")
}

// User Preferences
model UserPreferences {
  id                   String   @id @default(cuid())
  userId               String   @unique
  language             String   @default("en")
  currency             String   @default("USD")
  timezone             String   @default("UTC")
  emailNotifications   Boolean  @default(true)
  pushNotifications    Boolean  @default(true)
  smsNotifications     Boolean  @default(false)
  marketingEmails      Boolean  @default(false)
  autoAcceptBookings   Boolean  @default(false)
  instantBook          Boolean  @default(false)
  bookingMode          String? // API expects bookingMode
  minBookingDuration   Int      @default(1) // hours
  maxBookingDuration   Int      @default(30) // days
  advanceBookingNotice Int      @default(24) // hours
  preferences          String? // API expects preferences (JSON)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

// Favorite Listings
model FavoriteListing {
  id        String   @id @default(cuid())
  userId    String
  listingId String
  createdAt DateTime @default(now())

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  listing Listing @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@map("favorite_listings")
}

// Cancellation Policies
model CancellationPolicy {
  id                   String   @id @default(cuid())
  name                 String   @unique
  description          String
  type                 String // strict, moderate, flexible, etc.
  fullRefundHours      Int      @default(24) // Hours before check-in for full refund
  partialRefundHours   Int      @default(48) // Hours before check-in for partial refund
  partialRefundPercent Decimal  @default(0.5)
  noRefundHours        Int      @default(0) // Hours before check-in when no refund
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  listings Listing[]

  @@map("cancellation_policies")
}

// Condition Reports
model ConditionReport {
  id            String   @id @default(cuid())
  bookingId     String
  propertyId    String
  createdBy     String
  checkIn       Boolean  @default(false)
  checkOut      Boolean  @default(false)
  photos        String[] // JSON array of photo URLs
  notes         String?
  damages       String? // JSON array of damage reports
  signature     String? // Base64 signature
  status        String? // API expects status
  reportType    String? // API expects reportType
  checklistData String? // API expects checklistData (JSON)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  booking  Booking   @relation(fields: [bookingId], references: [id])
  property Listing   @relation(fields: [propertyId], references: [id])
  creator  User      @relation("ConditionReportCreator", fields: [createdBy], references: [id])
  disputes Dispute[]

  @@map("condition_reports")
}

// Insurance Policies
model InsurancePolicy {
  id             String          @id @default(cuid())
  policyNumber   String          @unique
  bookingId      String
  propertyId     String
  userId         String
  type           InsuranceType
  provider       String
  coverage       Decimal
  coverageAmount Decimal? // Added for admin service
  premium        Decimal
  currency       String          @default("USD")
  status         InsuranceStatus @default(ACTIVE)
  startDate      DateTime
  endDate        DateTime
  documents      String[] // JSON array of document URLs
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  // Relations
  booking  Booking          @relation(fields: [bookingId], references: [id])
  property Listing          @relation(fields: [propertyId], references: [id])
  user     User             @relation("InsurancePolicyOwner", fields: [userId], references: [id])
  claims   InsuranceClaim[]

  @@map("insurance_policies")
}

// Insurance Claims
model InsuranceClaim {
  id              String      @id @default(cuid())
  policyId        String
  bookingId       String?
  propertyId      String?
  claimNumber     String      @unique
  claimAmount     Decimal
  description     String
  incidentDate    DateTime
  status          ClaimStatus @default(PENDING)
  approvedAmount  Decimal?
  rejectionReason String?
  documents       String[] // JSON array of document URLs
  notes           String?
  submittedAt     DateTime    @default(now())
  reviewedAt      DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  policy   InsurancePolicy @relation(fields: [policyId], references: [id])
  booking  Booking?        @relation(fields: [bookingId], references: [id])
  property Listing?        @relation("PropertyClaims", fields: [propertyId], references: [id])

  @@index([policyId])
  @@index([bookingId])
  @@index([status])
  @@map("insurance_claims")
}

// Email Templates
model EmailTemplate {
  id          String            @id @default(cuid())
  name        String            @unique
  subject     String
  body        String // HTML content
  type        EmailTemplateType
  description String?
  variables   String[] // JSON array of available template variables
  isActive    Boolean           @default(true)
  category    String? // e.g., "transactional", "marketing", "system"
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([type])
  @@index([isActive])
  @@map("email_templates")
}

// Conversations
model Conversation {
  id            String             @id @default(cuid())
  bookingId     String?
  listingId     String?
  type          ConversationType   @default(GENERAL)
  status        ConversationStatus @default(ACTIVE)
  lastMessageAt DateTime? // API expects lastMessageAt
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  // Relations
  booking      Booking?                  @relation(fields: [bookingId], references: [id])
  listing      Listing?                  @relation("PropertyConversations", fields: [listingId], references: [id])
  messages     Message[]
  participants ConversationParticipant[]

  @@map("conversations")
}

model Message {
  id             String      @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  type           MessageType @default(TEXT)
  attachments    String[] // JSON array of attachment URLs
  readAt         DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  // Relations
  conversation Conversation         @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User                 @relation("MessageSender", fields: [senderId], references: [id])
  readReceipts MessageReadReceipt[]

  @@map("messages")
}

model ConversationParticipant {
  id             String    @id @default(cuid())
  conversationId String
  userId         String
  lastReadAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@map("conversation_participants")
}

model MessageReadReceipt {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  readAt    DateTime @default(now())

  // Relations
  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
  @@map("message_read_receipts")
}

// Disputes
model Dispute {
  id                String                 @id @default(cuid())
  bookingId         String
  conditionReportId String?                @unique
  initiatorId       String
  defendantId       String
  assignedTo        String?
  title             String // Added for disputes service
  type              DisputeType
  status            DisputeStatus          @default(OPEN)
  priority          DisputePriority        @default(MEDIUM)
  description       String
  amount            Decimal? // Added for disputes service
  evidence          DisputeEvidence[]
  responses         DisputeResponse[]
  timelineEvents    DisputeTimelineEvent[]
  resolution        DisputeResolution?
  resolvedAt        DateTime? // Added for disputes service
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt

  // Relations
  booking         Booking          @relation(fields: [bookingId], references: [id])
  conditionReport ConditionReport? @relation(fields: [conditionReportId], references: [id])
  initiator       User             @relation("DisputeInitiator", fields: [initiatorId], references: [id])
  defendant       User             @relation("DisputeDefendant", fields: [defendantId], references: [id])
  assignee        User?            @relation("DisputeAssignee", fields: [assignedTo], references: [id])

  @@map("disputes")
}

model DisputeEvidence {
  id         String   @id @default(cuid())
  disputeId  String
  type       String // photo, document, message, etc.
  url        String
  caption    String?
  uploadedBy String
  createdAt  DateTime @default(now())

  // Relations
  dispute Dispute @relation(fields: [disputeId], references: [id], onDelete: Cascade)

  @@map("dispute_evidence")
}

model DisputeResponse {
  id          String   @id @default(cuid())
  disputeId   String
  userId      String
  content     String
  type        String // statement, evidence, etc.
  attachments String[] // Added for disputes service - JSON array
  createdAt   DateTime @default(now())

  // Relations
  dispute Dispute @relation(fields: [disputeId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id])

  @@map("dispute_responses")
}

model DisputeTimelineEvent {
  id        String   @id @default(cuid())
  disputeId String
  event     String // created, assigned, evidence_added, etc.
  details   String?
  createdAt DateTime @default(now())

  // Relations
  dispute Dispute @relation(fields: [disputeId], references: [id], onDelete: Cascade)

  @@map("dispute_timeline_events")
}

model DisputeResolution {
  id         String         @id @default(cuid())
  disputeId  String         @unique
  type       ResolutionType
  outcome    String
  amount     Decimal?
  details    String?
  resolvedBy String
  resolvedAt DateTime       @default(now())

  // Relations
  dispute Dispute @relation(fields: [disputeId], references: [id])

  @@map("dispute_resolutions")
}

// Enums
enum UserRole {
  USER
  HOST
  ADMIN
  SUPER_ADMIN
  CUSTOMER
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DELETED
  PENDING_VERIFICATION
}

enum PropertyType {
  APARTMENT
  HOUSE
  VILLA
  STUDIO
  CONDO
  TOWNHOUSE
  COTTAGE
  CABIN
  LOFT
  OTHER
}

enum PropertyStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  UNAVAILABLE
  DRAFT
  SUSPENDED
  ARCHIVED
}

enum PropertyCondition {
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum BookingStatus {
  DRAFT
  PENDING
  PENDING_PAYMENT
  PENDING_OWNER_APPROVAL
  CONFIRMED
  IN_PROGRESS
  CANCELLED
  DISPUTED
  COMPLETED
  AWAITING_RETURN_INSPECTION
  REFUNDED
  SETTLED
}

enum BookingMode {
  REQUEST
  INSTANT_BOOK
}

enum PricingMode {
  PER_NIGHT
  PER_MONTH
  PER_HOUR
  PER_DAY
  PER_WEEK
  CUSTOM
}

enum DepositType {
  FIXED
  PERCENTAGE
  NONE
}

enum ListingStatus {
  DRAFT
  PUBLISHED
  ACTIVE
  INACTIVE
  SUSPENDED
  ARCHIVED
  PENDING_REVIEW
  REJECTED
}

enum ReviewType {
  LISTING_REVIEW
  RENTER_REVIEW
  OWNER_REVIEW
}

enum ReviewStatus {
  DRAFT
  PUBLISHED
  HIDDEN
  FLAGGED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
  SUCCEEDED
}

enum RefundStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  SUCCEEDED
}

enum DepositStatus {
  PENDING
  AUTHORIZED
  HELD
  RELEASED
  CAPTURED
  FAILED
}

enum PayoutStatus {
  PENDING
  PROCESSING
  IN_TRANSIT
  COMPLETED
  PAID
  FAILED
  CANCELLED
}

enum AccountType {
  REVENUE
  EXPENSE
  LIABILITY
  ASSET
  EQUITY
  CASH
  RECEIVABLE
  PAYABLE
}

enum LedgerSide {
  DEBIT
  CREDIT
}

enum TransactionType {
  PLATFORM_FEE
  SERVICE_FEE
  PAYMENT
  REFUND
  PAYOUT
  DEPOSIT_HOLD
  OWNER_EARNING
  DEPOSIT_RELEASE
  DISPUTE
}

enum LedgerEntryStatus {
  PENDING
  POSTED
  SETTLED
  CANCELLED
}

enum NotificationType {
  BOOKING_REQUEST
  BOOKING_CONFIRMED
  BOOKING_CANCELLED
  BOOKING_REMINDER
  PAYMENT_RECEIVED
  REVIEW_RECEIVED
  MESSAGE_RECEIVED
  SYSTEM_UPDATE
  SYSTEM_ANNOUNCEMENT
  MARKETING
  PAYOUT_PROCESSED
  VERIFICATION_COMPLETE
  DISPUTE_OPENED
  LISTING_APPROVED
}

enum OrganizationStatus {
  ACTIVE
  SUSPENDED
  PENDING_VERIFICATION
}

enum OrganizationRole {
  OWNER
  ADMIN
  MEMBER
}

enum InsuranceType {
  PROPERTY_DAMAGE
  LIABILITY
  TRIP_CANCELLATION
  MEDICAL
}

enum InsuranceStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  PENDING
}

enum ClaimStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSING
  PAID
  CANCELLED
}

enum EmailTemplateType {
  BOOKING_CONFIRMATION
  BOOKING_CANCELLATION
  PAYMENT_CONFIRMATION
  PAYMENT_RECEIPT
  WELCOME
  PASSWORD_RESET
  EMAIL_VERIFICATION
  LISTING_APPROVED
  LISTING_REJECTED
  REVIEW_REMINDER
  PAYOUT_NOTIFICATION
  DISPUTE_OPENED
  DISPUTE_RESOLVED
  SYSTEM_NOTIFICATION
}

enum ConversationType {
  GENERAL
  BOOKING
  DISPUTE
  SUPPORT
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  CLOSED
}

enum MessageType {
  TEXT
  IMAGE
  DOCUMENT
  LOCATION
  SYSTEM
}

enum DisputeType {
  PROPERTY_DAMAGE
  PAYMENT_ISSUE
  CANCELLATION
  CLEANING_FEE
  RULES_VIOLATION
  MISSING_ITEMS
  CONDITION_MISMATCH
  REFUND_REQUEST
  OTHER
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  INVESTIGATING
  RESOLVED
  CLOSED
  DISMISSED
}

enum DisputePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ResolutionType {
  FULL_REFUND
  PARTIAL_REFUND
  CHARGE_BACK
  COMPENSATION
  DISMISSED
}
